# AGENTS.md

## Цель документа
- Этот файл описывает рабочие правила для агентных правок в проекте `/Users/artemsafin/Desktop/projects/biv`.
- Приоритет: вносить минимальные, проверяемые и совместимые с текущей архитектурой изменения.

## Технологии и стек
- `Vite 7` + `TypeScript (strict)` + `SCSS` + `Handlebars` (через `vite-plugin-handlebars`).
- JS/UI-часть: классы компонентов в `src/js/classes`, инициализация через `src/js/main.ts`.
- Стили: layered-архитектура с `@layer` и `@use`.

## Быстрый старт
- Установка зависимостей: `npm install`
- Локальная разработка: `npm run dev`
- Прод-сборка (обязательная проверка после значимых правок): `npm run build`
- Просмотр сборки: `npm run preview`

## Ключевая структура проекта
- `src/js/main.ts` — единая точка входа (`ui()`, `sections()`, `initForms()`).
- `src/js/ui` — инициализация UI-компонентов (аккордеоны и т.п.).
- `src/js/forms` — подключение валидации и AJAX-форм.
- `src/js/classes` — переиспользуемые классы компонентов и сервисов.
- `src/scss` — стили по слоям (`tokens`, `base`, `layout`, `components`, `sections`, `utilities`).
- `pages/*.html` — HTML-страницы, собираемые Vite.
- `partials/**` — Handlebars partials.
- `pages-data/*.js` — данные страниц (title и др. контекст).
- `public/**` — статические ресурсы (шрифты, картинки).
- `dist/**` — артефакты сборки (не редактировать вручную).

## Правила редактирования
- Изменения вносятся в исходники (`src`, `pages`, `partials`, `pages-data`, `public`), не в `dist`.
- Не редактировать `node_modules`.
- Сохранять существующий код-стиль (ESM, форматирование, именование).
- Для новых TS-файлов соблюдать strict-подход:
  - не использовать `any` без критической необходимости;
  - учитывать `noUnusedLocals` и `noUnusedParameters`.
- Для UI-компонентов придерживаться текущего паттерна:
  - наследование от `Component`;
  - корректная очистка обработчиков в `destroy()`;
  - вызов `this.unregister()` при уничтожении.
- При добавлении/изменении форм использовать существующие абстракции:
  - `FormValidator` (`src/js/classes/facades/FormValidator.ts`);
  - `AJAXForm` (`src/js/classes/components/AJAXForm.ts`).
- Для SCSS:
  - сохранять layered-структуру;
  - новые дизайн-токены добавлять в `src/scss/tokens/*`;
  - не ломать общие переменные `:root`.

## Правила для страниц и шаблонов
- Новые страницы добавлять в `pages/*.html`.
- Контекст страницы добавлять в соответствующий файл `pages-data/*.js`.
- Если нужна общая разметка, выносить в `partials`.
- Учитывать, что `pages.config.js` автоматически собирает список страниц для `/pages.html`.

## Правила верстки по Figma
- Максимально следовать макету из Figma: брать размеры, отступы, типографику, цвета и прочие значения из макета, не выдумывать собственные.
- Не делать адаптивную верстку, пока это не запрошено явно.
- Использовать масштаб: `1rem = 10px`.
- Если адаптив запрошен, делать его только для мобильного брейкпоинта.
- Для списков, слайдеров и аналогичных повторяющихся блоков:
  - выделять отдельный компонент карточки или переиспользовать уже существующий;
  - выводить дочерние элементы через данные страницы (`pages-data`) и цикл в Handlebars, а не дублировать вручную в шаблоне.

## Правила по изображениям
- Растровые изображения должны быть в формате `webp` (или конвертированы в `webp` перед добавлением в проект).
- `SVG` не конвертировать в `webp` или другие растровые форматы.
- Иконки хранить в `src/icons` и подключать через `<use>` по `id` (SVG-спрайт).
- Перед использованием SVG-иконок убирать инлайновую заливку (`fill`), чтобы стилизовать иконки через CSS.
- Изображения в `images` раскладывать по папкам согласно секции или компоненту.
- Пример структуры: `images/news-card/1.webp`, `images/news-card/2.webp`, `images/news-card/3.webp`.

## Проверки перед завершением задачи
- Минимум: `npm run build` должен проходить без ошибок.
- Для заметных изменений UI дополнительно проверить страницу в `npm run dev`.
- В отчёте указывать:
  - какие файлы изменены;
  - что именно изменено;
  - результат проверки сборки.

## Ограничения и осторожность
- Не менять поведение плагинов в `vite.config.js` без явной необходимости:
  - `cssRelativePublicUrls`;
  - `flattenPagesPlugin`;
  - `vite-plugin-handlebars`;
  - `vite-plugin-svg-icons`.
- Не удалять существующие публичные API без запроса (например, `window.innoApi.Validator`).
- Избегать массовых рефакторингов без отдельной задачи.

## Рекомендованный формат работы агента
1. Прочитать затронутые файлы и зависимости по фиче.
2. Внести минимальные целевые изменения.
3. Проверить `npm run build`.
4. Кратко описать результат и возможные риски.
